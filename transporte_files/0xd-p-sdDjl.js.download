if (self.CavalryLogger) { CavalryLogger.start_js(["wnN5e"]); }

__d('FantaTypeFileUploaderFile',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={file:{},id:'',startTime:0,type:null,uploadedID:null};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d('FantaReducersFileUploader',['fbt','Dialog','FantaMessageActions','FantaTabActions','FantaTypeFileUploader','FantaTypeFileUploaderFile','FileForm','FileFormResetOnSubmit','FormSubmitOnChange','MercuryConfig','MercuryConstants','PhotosUploadID','SubscriptionsHandler'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('FantaMessageActions').Types,j=c('FantaTabActions').Types;function k(x,y){switch(y.type){case i.PREPARE_FILES_FOR_SEND:var z=y.files,aa=y.tabID,ba=x.mercury.tabContents.get(aa);if(!ba)return x;var ca=l(),da=m(ca),ea=n(aa,ca,da);o(aa,ea,da);return p(x,aa,ea,z);}return x;}function l(){var x=document.createElement('form');x.action=c('MercuryConfig').upload_url;x.method='post';return x;}function m(x,y){var z=document.createElement('input');z.type='file';z.name='attachment[]';z.multiple=true;if(y)z.onchange=y;x.appendChild(z);return z;}function n(x,y,z){var aa=new (c('FileForm'))(y,[c('FormSubmitOnChange'),c('FileFormResetOnSubmit')]);aa.setAllowCrossOrigin(true);aa.setUploadInParallel(true);return aa;}function o(x,y,z){var aa=new (c('SubscriptionsHandler'))();aa.addSubscriptions(y.subscribe('submit',function(){if(z.files){c('FantaMessageActions').prepareFilesForSend(x,z.files);}}),y.subscribe('success',function(event,ba){var ca=ba.response.getPayload();c('FantaMessageActions').uploadedFile(x,t(ba),ca);}),y.subscribe('failure',function(event,ba){c('FantaMessageActions').uploadFileFailed(x,t(ba));}));return aa;}function p(x,y,z,aa){if(!z.canUseXHR())return x;var ba={};for(var ca=0;ca<aa.length;ca++){var da=aa[ca];if(da.size>c('MercuryConstants').AttachmentMaxSize){z.abort();z.clear();new (c('Dialog'))().setTitle(h._("O arquivo selecionado \u00e9 muito grande")).setBody(h._("O arquivo selecionado \u00e9 muito grande. O tamanho m\u00e1ximo \u00e9 de 25 MB.")).setButtons(c('Dialog').OK).setSemiModal(true).show();return x;}}for(var ea=0;ea<aa.length;ea++){var fa=aa[ea],ga=u();x=q(x,y,ga,fa);ba[ga]=fa;}z.setFiles(ba);z.forceSendViaXHR();return x;}function q(x,y,z,aa){if(!x.mercury.tabContents.get(y))return x;x=x.setIn(['mercury','tabContents',y,'fileUploader','uploadingFiles',z],new (c('FantaTypeFileUploaderFile'))({file:aa,id:z,startTime:Date.now()}));return x;}function r(x,y){switch(y.type){case i.UPLOADED_FILE:var z=y.payload,aa=y.uploadID,ba=y.tabID,ca=x.mercury.tabContents.get(ba);if(!ca)return x;var da=ca.fileUploader.uploadingFiles.get(aa);x=x.deleteIn(['mercury','tabContents',ba,'fileUploader','uploadingFiles',aa]);if(da){var ea=z.metadata[0],fa=c('FantaTypeFileUploader').fileTypes.GENERIC_ATTACHMENT,ga=ea;if(ea.image_id){fa=c('FantaTypeFileUploader').fileTypes.IMAGE;ga=ea.image_id;}else if(ea.gif_id){fa=c('FantaTypeFileUploader').fileTypes.ANIMATED_IMAGE;ga=ea.gif_id;}else if(ea.video_id){fa=c('FantaTypeFileUploader').fileTypes.VIDEO;ga=ea.video_id;}else if(ea.audio_id){fa=c('FantaTypeFileUploader').fileTypes.AUDIO;ga=ea.audio_id;}else if(ea.file_id){fa=c('FantaTypeFileUploader').fileTypes.FILE;ga=ea.file_id;}x=x.setIn(['mercury','tabContents',ba,'fileUploader','uploadedFiles',aa],da.merge({uploadedID:ga,type:fa}));}}return x;}function s(x,y){switch(y.type){case i.CANCEL_FILE_UPLOAD:case i.UPLOAD_FILE_FAILED:var z=y.uploadID,aa=y.tabID,ba=x.mercury.tabContents.get(aa);if(!ba)return x;var ca=ba.fileUploader.uploadingFiles.get(z);if(ca){x=x.deleteIn(['mercury','tabContents',aa,'fileUploader','uploadingFiles',z]);}else{var da=ba.fileUploader.uploadedFiles.get(z);if(da)x=x.deleteIn(['mercury','tabContents',aa,'fileUploader','uploadedFiles',z]);}}return x;}function t(x){var y=x.response.getPayload();if(x.upload){return x.upload.getName();}else return y.uploadID;}function u(){return 'upload_'+c('PhotosUploadID').getNewID();}function v(x,y){switch(y.type){case j.CLOSE_ALL_TABS:var z=x.tabGroup.tabs.keys();for(var aa=z,ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var da;if(ba){if(ca>=aa.length)break;da=aa[ca++];}else{ca=aa.next();if(ca.done)break;da=ca.value;}var ea=da;x=w(x,ea);}return x;case j.CLOSE_AND_TAB_NEXT:case j.CLOSE_TAB:var fa=y.tabID;return w(x,fa);}return x;}function w(x,y){if(!x.mercury.tabContents.get(y))return x;return x.setIn(['mercury','tabContents',y,'fileUploader'],new (c('FantaTypeFileUploader'))());}f.exports={cancelFileUpload:s,closeTab:v,prepareFilesForSend:k,uploadedFile:r};}),null);